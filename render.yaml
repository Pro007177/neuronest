# Render Blueprint specification: https://render.com/docs/blueprint-spec

databases:
  # PostgreSQL Database Service (Free Tier)
  - name: neuronest-db
    databaseName: neuronest_db
    user: neuronest_user
    plan: free
    region: oregon # Databases CAN have regions

services:
  # Backend API Service (FastAPI)
  - type: web
    name: neuronest-api
    runtime: python
    region: oregon # Web services CAN have regions
    rootDir: backend
    plan: free
    buildCommand: |
      pip install --upgrade pip
      pip install -r requirements.txt
      alembic upgrade head
    startCommand: "uvicorn app.main:app --host 0.0.0.0 --port $PORT"
    healthCheckPath: /api/health
    envVars:
      - key: PYTHON_VERSION
        value: 3.11
      - key: DATABASE_URL
        fromDatabase:
          name: neuronest-db
          property: connectionString
      - key: ANTHROPIC_API_KEY
        fromSecret: true # Value will be set in Render Dashboard Secrets
      - key: JWT_SECRET_KEY
        fromSecret: true # Value will be set in Render Dashboard Secrets
      - key: FRONTEND_ORIGIN
        # IMPORTANT: Render cannot automatically get the public URL of the static site via fromService.
        # Set this manually in the Render Dashboard Environment settings for 'neuronest-api'
        # AFTER 'neuronest-web' is deployed, e.g., https://neuronest-web.onrender.com
        value: "https://your-frontend-url-placeholder.onrender.com" # Placeholder - MUST BE UPDATED MANUALLY
      - key: APP_ENV
        value: production

  # Frontend Application Service (React Static Site)
  - type: web
    name: neuronest-web
    runtime: static
    # region: oregon # REMOVED: Static sites cannot have a region
    rootDir: .
    plan: free
    buildCommand: |
      npm install
      npm run build
    staticPublishPath: build
    envVars:
      # Set the API URL for the React build process.
      # Use the internal service address format Render provides.
      - key: REACT_APP_API_URL
        # This constructs the internal URL. Render injects $PORT (usually 10000 for web services).
        # Replace '10000' if your backend service uses a different internal port, though Render usually manages this.
        # Alternatively, reference the public URL manually if needed, but internal is often better.
        value: "http://neuronest-api:10000" # Use internal service name and typical internal port
        # If the above causes issues, try getting the public URL manually in the dashboard build settings
        # or use fromService with 'hostport' if that property becomes available for web services.
    routes:
      - type: rewrite
        source: /*
        destination: /index.html