# Render Blueprint specification: https://render.com/docs/blueprint-spec

databases:
  # PostgreSQL Database Service (Free Tier)
  - name: neuronest-db
    databaseName: neuronest_db
    user: neuronest_user
    plan: free
    region: oregon

services:
  # Backend API Service (FastAPI)
  - type: web
    name: neuronest-api
    runtime: python
    region: oregon
    rootDir: backend
    plan: free
    buildCommand: |
      pip install --upgrade pip
      pip install -r requirements.txt
      alembic upgrade head
    startCommand: "uvicorn app.main:app --host 0.0.0.0 --port $PORT"
    healthCheckPath: /api/health
    envVars:
      - key: PYTHON_VERSION
        value: 3.11
      - key: DATABASE_URL
        fromDatabase:
          name: neuronest-db
          property: connectionString
      # Define keys for secrets, leave value empty. Render will prompt.
      # This approach avoids 'fromSecret' which seems to cause validation issues here.
      - key: ANTHROPIC_API_KEY
        value: "" # Leave value empty - Set in Dashboard Environment/Secrets
      - key: JWT_SECRET_KEY
        value: "" # Leave value empty - Set in Dashboard Environment/Secrets
      - key: FRONTEND_ORIGIN
        # IMPORTANT: Render cannot automatically get the public URL of the static site.
        # Set this manually in the Render Dashboard Environment settings for 'neuronest-api'
        # AFTER 'neuronest-web' is deployed, e.g., https://neuronest-web.onrender.com
        value: "https://your-frontend-url-placeholder.onrender.com" # Placeholder - MUST BE UPDATED MANUALLY
      - key: APP_ENV
        value: production

  # Frontend Application Service (React Static Site)
  - type: web
    name: neuronest-web
    runtime: static
    # region: oregon # REMOVED: Static sites cannot have a region
    rootDir: .
    plan: free
    buildCommand: |
      npm install
      npm run build
    staticPublishPath: build
    envVars:
      # Set the API URL for the React build process using internal service address.
      - key: REACT_APP_API_URL
        value: "http://neuronest-api:10000" # Use internal service name and typical internal port
    routes:
      - type: rewrite
        source: /*
        destination: /index.html